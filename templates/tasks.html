
<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <title>Mes TÃ¢ches</title>
    {% include 'styles.html' %}
</head>

<body>
    <form method="POST" action="/logout" class="logout-top-right" onsubmit="return confirmLogout();">
        <button type="submit">DÃ©connexion</button>
    </form>

    <div class="container">
        <h1>ðŸ“‹ Mes TÃ¢ches</h1>

        <form method="GET" action="/tasks" class="filter-form">
            <div class="filter-line">
                <select name="category">
                    <option value="all">Toutes les catÃ©gories</option>
                    {% for cat in categories %}
                    <option value="{{ cat.id }}">{{ cat.name }}</option>
                    {% endfor %}
                </select>

                <select name="priority">
                    <option value="all">Toutes les prioritÃ©s</option>
                    {% for prio in priorities %}
                    <option value="{{ prio.id }}">{{ prio.level }}</option>
                    {% endfor %}
                </select>

                <select name="status">
                    <option value="all">Tous les statuts</option>
                    <option value="Ã  faire">Ã€ faire</option>
                    <option value="en cours">En cours</option>
                    <option value="terminÃ©">TerminÃ©</option>
                </select>
            </div>

            <div class="filter-submit">
                <button type="submit">Filtrer</button>
            </div>
        </form>


        <ul class="task-list">
            {% for task in todos %}
            <li>
                <div class="task-box">
                    <div class="task-left">
                        <strong>{{ task.task }}</strong>
                    </div>
                    <div class="task-right">
                        <div class="task-meta">
                            <span class="category-tag">ðŸ“‚ {{ task.category_name or "Non spÃ©cifiÃ©e" }}</span>
                            <span class="priority-tag {{ task.priority_level|lower }}">ðŸ”¥ {{ task.priority_level
                                }}</span>
                        </div>
                        <div class="task-actions">
                            <form method="POST" action="/update/{{ task.id }}">
                                <select name="status" class="task-status" onchange="this.form.submit()">
                                    <option value="Ã  faire" {% if task.status=='Ã  faire' %}selected{% endif %}>Ã€ faire
                                    </option>
                                    <option value="en cours" {% if task.status=='en cours' %}selected{% endif %}>En
                                        cours</option>
                                    <option value="terminÃ©" {% if task.status=='terminÃ©' %}selected{% endif %}>TerminÃ©
                                    </option>
                                </select>
                            </form>
                            <form method="POST" action="/delete/{{ task.id }}">
                                <button type="submit" class="delete-btn" title="Supprimer">&#128465;</button>
                            </form>
                        </div>
                    </div>
                </div>
            </li>
            {% endfor %}
        </ul>

        <script>
            function confirmLogout() {
                return confirm("ÃŠtes-vous sÃ»r de vouloir vous dÃ©connecter ?");
            }
        </script>


        <div style="text-align:center; margin-top: 1rem;">
            <a href="/" class="add-button" style="display: inline-block;">âž• Ajouter une nouvelle tÃ¢che</a>
        </div>
    </div>
</body>

</html>